FROM docker.io/debian:bookworm-slim@sha256:67f3931ad8cb1967beec602d8c0506af1e37e8d73c2a0b38b181ec5d8560d395
RUN apt-get update -y && apt-get upgrade -y && apt-get install -y --no-install-recommends \
    ca-certificates gettext gosu

RUN apt-get update -y && apt-get install -y --no-install-recommends \
    python3 python3-pip python3-venv python3-pytz-deprecation-shim curl

ARG VERSION=3.2.1 # renovate: datasource=github-releases depName=Kozea/Radicale extractVersion=^v(?<version>.*)$
RUN python3 -m venv /venv && \
    /venv/bin/pip install https://github.com/Kozea/Radicale/archive/v${VERSION}.tar.gz && \
    /venv/bin/pip install --no-deps https://github.com/Unrud/RadicaleIMAP/archive/master.tar.gz

RUN adduser --system --group --uid 10000 --home /var/lib/radicale radicale

COPY container/config /etc/radicale
COPY container/run-radicale /run-radicale

EXPOSE 5232
ENTRYPOINT ["/run-radicale"]
